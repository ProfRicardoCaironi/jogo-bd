<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Missão DBA: Protocolo Final - Ultimate Edition</title>
    <style>
        /* --- ESTILO HACKER / TERMINAL --- */
        body {
            background-color: #0d1117;
            color: #3fb950;
            font-family: 'Courier New', Courier, monospace;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            user-select: none;
        }

        #game-console {
            width: 900px;
            height: 85vh;
            background-color: #161b22;
            border: 2px solid #3fb950;
            box-shadow: 0 0 25px rgba(63, 185, 80, 0.2);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            padding: 20px;
            position: relative;
        }

        /* BARRA SUPERIOR */
        #top-bar {
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid #30363d;
            padding-bottom: 10px;
            margin-bottom: 10px;
            font-weight: bold;
            font-size: 18px;
        }

        #lives { color: #ff7b72; text-shadow: 0 0 5px rgba(255, 123, 114, 0.5); }
        #timer { color: #e3b341; }
        #phase-display { color: #58a6ff; }

        /* TELA DE SAÍDA */
        #output-screen {
            flex-grow: 1;
            overflow-y: auto;
            margin-bottom: 20px;
            padding-right: 10px;
            font-size: 16px;
            line-height: 1.6;
            border-bottom: 1px solid #30363d;
        }

        /* CORES DAS MENSAGENS */
        .msg-system { color: #58a6ff; font-weight: bold; margin-top: 10px; }
        .msg-error { color: #ff7b72; font-weight: bold; }
        .msg-warning { color: #d29922; font-weight: bold; background-color: rgba(210, 153, 34, 0.1); padding: 5px; border-left: 3px solid #d29922; margin: 5px 0; }
        .msg-success { color: #3fb950; font-weight: bold; }
        .msg-npc { color: #d2a8ff; font-style: italic; }
        .msg-sql { color: #e3b341; background: #21262d; padding: 2px 5px; border-radius: 4px; }

        /* ÁREA DE BOTÕES */
        #controls-area {
            display: flex;
            flex-direction: column;
            gap: 10px;
            min-height: 160px;
        }

        button {
            background-color: #238636;
            color: #ffffff;
            border: 1px solid rgba(240, 246, 252, 0.1);
            padding: 12px;
            border-radius: 6px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 14px;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s ease;
        }

        button:hover {
            background-color: #2ea043;
            transform: translateX(5px);
            border-color: #3fb950;
        }

        button:disabled {
            background-color: #21262d;
            color: #484f58;
            cursor: not-allowed;
            transform: none;
            border-color: transparent;
        }

        /* BOTÃO ESPECIAL DE FASE */
        .btn-phase2 {
            background-color: #8957e5 !important; /* Roxo */
            text-align: center;
            font-weight: bold;
            font-size: 16px;
        }
        .btn-phase2:hover { background-color: #a371f7 !important; }

        /* BARRA DE PROGRESSO */
        #status-bar {
            margin-top: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: #8b949e;
        }

        #progress-container {
            width: 50%;
            height: 8px;
            background-color: #30363d;
            border-radius: 4px;
            overflow: hidden;
        }

        #progress-fill {
            height: 100%;
            width: 0%;
            background-color: #3fb950;
            transition: width 0.5s ease-in-out;
        }

        /* IMAGEM DE GAME OVER */
        .hacker-img {
            width: 100%;
            max-height: 350px;
            object-fit: cover;
            border: 2px solid #ff7b72;
            border-radius: 8px;
            margin-bottom: 15px;
            opacity: 0.9;
        }

        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: #0d1117; }
        ::-webkit-scrollbar-thumb { background: #30363d; border-radius: 5px; }
    </style>
</head>
<body>

    <div id="game-console">
        <div id="top-bar">
            <span id="phase-display">FASE: 1 (RECUPERAÇÃO)</span>
            <span id="lives">VIDAS: [♥♥♥]</span>
            <span id="timer">TEMPO: 00:00</span>
        </div>

        <div id="output-screen">
            <div class="msg-system">INITIALIZING DB_RECOVERY_TOOL_V4.0...</div>
            <div class="msg-system">SECURITY PROTOCOL: ACTIVE</div>
            <div class="msg-success">SYSTEM READY.</div>
            <br>
            <div class="msg-npc">CLIENTE DA LOJA VIRTUAL DIZ:</div>
            <div class="msg-npc">"Atenção!Perdemos todos o nosso banco de dados!O sistema de segurança está instável. Se cometermos 3 erros, o servidor vai bloquear nosso acesso. Leia com atenção!"</div>
            <br>
        </div>

        <div id="controls-area">
            <!-- Botões gerados via JS -->
        </div>

        <div id="status-bar">
            <span id="level-indicator">NÍVEL: 0/15</span>
            <div id="progress-container">
                <div id="progress-fill"></div>
            </div>
            <span>USER: SYSADMIN</span>
        </div>
    </div>

    <script>
        // --- DADOS DO JOGO ---
        
        // FASE 1: Básico (DDL, DML, DQL, Normalização) - 15 Níveis
        const levelsPhase1 = [
            {
                story: "1. Precisamos criar a tabela principal 'produtos'. Ela precisa de um ID único que se preencha sozinho.",
                question: "Qual comando cria a tabela corretamente?",
                options: [
                    { sql: "CREATE TABLE produtos (id INT, nome VARCHAR(100));", correct: false },
                    { sql: "CREATE TABLE produtos (id INT PRIMARY KEY AUTO_INCREMENT, nome VARCHAR(100), preco DECIMAL(10,2));", correct: true },
                    { sql: "INSERT INTO TABLE produtos VALUES (id, nome);", correct: false }
                ],
                success: "Tabela criada com PK e Auto_Increment.",
                fail: "Erro! Faltou definir a Primary Key ou Auto_Increment."
            },
            {
                story: "2. Esquecemos a coluna para a foto do produto! O site não pode ficar sem imagens.",
                question: "Qual comando altera a estrutura para adicionar 'imagem_url'?",
                options: [
                    { sql: "ALTER TABLE produtos ADD imagem_url VARCHAR(255);", correct: true },
                    { sql: "UPDATE produtos SET imagem_url = 'nova';", correct: false },
                    { sql: "ALTER TABLE produtos INSERT imagem_url;", correct: false }
                ],
                success: "Coluna adicionada via ALTER TABLE.",
                fail: "Para mudar estrutura (DDL), use ALTER TABLE ADD."
            },
            {
                story: "3. Vamos cadastrar o primeiro item: um 'Notebook Dell' custando 3500.00.",
                question: "Qual comando insere esse registro?",
                options: [
                    { sql: "ADD produtos ('Notebook Dell', 3500.00);", correct: false },
                    { sql: "INSERT INTO produtos (nome, preco) VALUES ('Notebook Dell', 3500.00);", correct: true },
                    { sql: "SELECT INTO produtos VALUES ...", correct: false }
                ],
                success: "Registro inserido com sucesso!",
                fail: "Use INSERT INTO ... VALUES para adicionar dados."
            },
            {
                story: "4. A inflação pegou! O 'Notebook Dell' agora custa 3800.00. Precisamos corrigir o preço.",
                question: "Qual comando atualiza apenas esse produto?",
                options: [
                    { sql: "UPDATE produtos SET preco = 3800.00 WHERE nome = 'Notebook Dell';", correct: true },
                    { sql: "UPDATE produtos SET preco = 3800.00;", correct: false },
                    { sql: "ALTER TABLE produtos CHANGE preco 3800.00;", correct: false }
                ],
                success: "Preço atualizado! O WHERE evitou um desastre.",
                fail: "Cuidado! Sem WHERE, você altera TODOS os preços."
            },
            {
                story: "5. Um estagiário cadastrou um produto chamado 'TESTE_LIXO'. Apague isso agora!",
                question: "Qual comando remove o registro com segurança?",
                options: [
                    { sql: "DELETE FROM produtos WHERE nome = 'TESTE_LIXO';", correct: true },
                    { sql: "DROP TABLE produtos;", correct: false },
                    { sql: "DELETE * FROM produtos;", correct: false }
                ],
                success: "Registro deletado corretamente.",
                fail: "DROP apaga a tabela! Use DELETE com WHERE."
            },
            {
                story: "6. Precisamos armazenar o telefone do fornecedor, ex: '(11)99999-8888'. Qual o tipo de dado correto?",
                question: "Escolha o tipo de dado mais adequado:",
                options: [
                    { sql: "INT (Inteiro)", correct: false },
                    { sql: "VARCHAR (Texto Variável)", correct: true },
                    { sql: "FLOAT (Decimal)", correct: false }
                ],
                success: "Exato! Telefones têm caracteres especiais '()-', então usamos VARCHAR.",
                fail: "Errado. INT não aceita parênteses ou traços. Use VARCHAR."
            },
            {
                story: "7. Na tabela 'fornecedores', o endereço está assim: 'Rua A, 10, Centro'. Isso viola a 1ª Forma Normal (1FN).",
                question: "Como resolver essa violação?",
                options: [
                    { sql: "Deixar tudo junto.", correct: false },
                    { sql: "Dividir em colunas atômicas: logradouro, numero, bairro.", correct: true },
                    { sql: "Criar uma tabela só para números.", correct: false }
                ],
                success: "Correto! Dados devem ser atômicos (indivisíveis) na 1FN.",
                fail: "A 1FN exige que separemos informações compostas."
            },
            {
                story: "8. O chefe quer ver os produtos do mais barato para o mais caro.",
                question: "Qual a ordenação correta?",
                options: [
                    { sql: "ORDER BY preco DESC", correct: false },
                    { sql: "ORDER BY preco ASC", correct: true },
                    { sql: "SORT BY preco", correct: false }
                ],
                success: "Listagem gerada em ordem ascendente (ASC).",
                fail: "DESC é decrescente (caro -> barato). Use ASC."
            },
            {
                story: "9. Precisamos de uma lista filtrada: Apenas produtos com preço entre 1000 e 2000.",
                question: "Qual operador de filtro é o ideal?",
                options: [
                    { sql: "WHERE preco > 1000 OR preco < 2000", correct: false },
                    { sql: "WHERE preco BETWEEN 1000 AND 2000", correct: true },
                    { sql: "WHERE preco IN (1000, 2000)", correct: false }
                ],
                success: "Filtro BETWEEN aplicado com sucesso.",
                fail: "Use BETWEEN para intervalos de valores."
            },
            {
                story: "10. Otimização de rede! O sistema está lento. O gerente quer ver APENAS o 'nome' e a 'quantidade' dos produtos, nada mais.",
                question: "Como selecionar colunas específicas?",
                options: [
                    { sql: "SELECT * FROM produtos;", correct: false },
                    { sql: "SELECT nome, quantidade FROM produtos;", correct: true },
                    { sql: "SHOW nome, quantidade FROM produtos;", correct: false }
                ],
                success: "Consulta otimizada! Trazendo apenas dados necessários.",
                fail: "SELECT * traz tudo e pesa o sistema. Especifique as colunas."
            },
            {
                story: "11. Busca específica: Precisamos encontrar produtos que sejam da categoria 'Gamer' E custem mais de 500 reais.",
                question: "Qual a lógica correta?",
                options: [
                    { sql: "WHERE categoria = 'Gamer' OR preco > 500", correct: false },
                    { sql: "WHERE categoria = 'Gamer' AND preco > 500", correct: true },
                    { sql: "WHERE categoria = 'Gamer' + preco > 500", correct: false }
                ],
                success: "Filtro lógico AND aplicado. Ambas condições são verdadeiras.",
                fail: "OR traria gamers baratos ou produtos caros não-gamer. Use AND."
            },
            {
                story: "12. Limpeza de Legado: Uma coluna antiga chamada 'obs_temporaria' não serve para nada.",
                question: "Como remover essa coluna da estrutura?",
                options: [
                    { sql: "DELETE COLUMN obs_temporaria FROM produtos;", correct: false },
                    { sql: "ALTER TABLE produtos DROP COLUMN obs_temporaria;", correct: true },
                    { sql: "DROP TABLE obs_temporaria;", correct: false }
                ],
                success: "Coluna removida da estrutura.",
                fail: "Para remover colunas, usamos ALTER TABLE ... DROP COLUMN."
            },
            {
                story: "13. Relacionamento: Criamos a tabela 'categorias'. Para ligar 'produtos' a ela (1:N), precisamos de um campo especial.",
                question: "O que criamos em 'produtos'?",
                options: [
                    { sql: "Primary Key (PK)", correct: false },
                    { sql: "Foreign Key (FK)", correct: true },
                    { sql: "Unique Key", correct: false }
                ],
                success: "Foreign Key criada para vincular as tabelas.",
                fail: "Primary Key identifica. Foreign Key conecta tabelas."
            },
            {
                story: "14. Conceito Final: O MySQL organiza dados em tabelas com linhas e colunas.",
                question: "Que tipo de Banco de Dados é esse?",
                options: [
                    { sql: "Banco de Dados Relacional", correct: true },
                    { sql: "Banco de Dados Não-Relacional (NoSQL)", correct: false },
                    { sql: "Banco de Dados Orientado a Objetos", correct: false }
                ],
                success: "Exato! MySQL é um SGBD Relacional (RDBMS).",
                fail: "Tabelas e Relacionamentos definem o modelo Relacional."
            },
            {
                story: "15. Auditoria: Quem gerencia o acesso, a segurança e a execução das queries no servidor?",
                question: "Qual é a sigla correta do software?",
                options: [
                    { sql: "BD (Banco de Dados)", correct: false },
                    { sql: "SGBD (Sistema Gerenciador de Banco de Dados)", correct: true },
                    { sql: "API (Interface de Programação)", correct: false }
                ],
                success: "FASE 1 CONCLUÍDA! Sistema Operacional.",
                fail: "O BD são os dados. O software é o SGBD (ex: MySQL, Oracle)."
            }
        ];

        // FASE 2: Avançado (DCL - Permissões e SQL - Joins) - 10 Níveis
        const levelsPhase2 = [
            {
                story: "16. [DCL] Segurança Máxima! Precisamos criar um usuário 'vendedor' que acessa do próprio computador (localhost) com a senha '12345'.",
                question: "Qual o comando correto?",
                options: [
                    { sql: "CREATE USER 'vendedor'@'localhost' IDENTIFIED BY '12345';", correct: true },
                    { sql: "ADD USER 'vendedor' PASSWORD '12345';", correct: false },
                    { sql: "INSERT INTO users VALUES ('vendedor', '12345');", correct: false }
                ],
                success: "Usuário criado com sucesso!",
                fail: "Sintaxe incorreta. Use CREATE USER 'nome'@'host' IDENTIFIED BY 'senha'."
            },
            {
                story: "17. [DCL] O 'vendedor' precisa poder ler (SELECT) e adicionar (INSERT) dados na tabela 'catalogo_produtos'.",
                question: "Como concedemos essas permissões?",
                options: [
                    { sql: "GIVE SELECT, INSERT TO 'vendedor'@'localhost';", correct: false },
                    { sql: "GRANT SELECT, INSERT ON catalogo_produtos.* TO 'vendedor'@'localhost';", correct: true },
                    { sql: "ALLOW 'vendedor' TO SELECT, INSERT;", correct: false }
                ],
                success: "Permissões concedidas (GRANT).",
                fail: "O comando para dar permissão é GRANT ... ON ... TO ..."
            },
            {
                story: "18. [DCL] Após alterar permissões, é uma boa prática garantir que o servidor recarregue as tabelas de acesso imediatamente.",
                question: "Qual comando faz isso?",
                options: [
                    { sql: "REFRESH DATABASE;", correct: false },
                    { sql: "FLUSH PRIVILEGES;", correct: true },
                    { sql: "RELOAD PERMISSIONS;", correct: false }
                ],
                success: "Privilégios recarregados!",
                fail: "O comando correto é FLUSH PRIVILEGES."
            },
            {
                story: "19. [JOIN] Precisamos de um relatório que mostre o nome do produto e o nome da sua categoria. Queremos APENAS produtos que tenham categoria definida.",
                question: "Qual JOIN usamos para correspondência exata nas duas tabelas?",
                options: [
                    { sql: "LEFT JOIN", correct: false },
                    { sql: "INNER JOIN", correct: true },
                    { sql: "CROSS JOIN", correct: false }
                ],
                success: "INNER JOIN retorna apenas a interseção (dados que existem em ambas).",
                fail: "LEFT traz tudo da esquerda. CROSS faz todas as combinações. Use INNER."
            },
            {
                story: "20. [JOIN] O gerente quer ver TODOS os produtos cadastrados, mesmo aqueles que ainda não têm categoria vinculada.",
                question: "Qual JOIN garante que todos os produtos (tabela da esquerda) apareçam?",
                options: [
                    { sql: "RIGHT JOIN", correct: false },
                    { sql: "INNER JOIN", correct: false },
                    { sql: "LEFT JOIN", correct: true }
                ],
                success: "LEFT JOIN traz tudo da tabela da esquerda (Produtos).",
                fail: "Para garantir a tabela da esquerda (FROM), use LEFT JOIN."
            },
            {
                story: "21. [JOIN] Análise Combinatória: Precisamos combinar cada produto com cada fornecedor possível para uma matriz de oportunidades.",
                question: "Qual comando gera esse Produto Cartesiano?",
                options: [
                    { sql: "CROSS JOIN", correct: true },
                    { sql: "INNER JOIN", correct: false },
                    { sql: "FULL OUTER JOIN", correct: false }
                ],
                success: "CROSS JOIN cria todas as combinações possíveis (NxM).",
                fail: "Produto cartesiano é feito com CROSS JOIN."
            },
            {
                story: "22. [SINTAXE] Vamos montar a query. Tabela A: Produtos (p), Tabela B: Categoria (c). A chave é fk_id_categoria.",
                question: "Qual a sintaxe correta do ON?",
                options: [
                    { sql: "ON p.id_produtos = c.id_categoria", correct: false },
                    { sql: "ON p.fk_id_categoria = c.id_categoria", correct: true },
                    { sql: "WHERE p.nome = c.nome", correct: false }
                ],
                success: "Ligação correta! FK da tabela filha = PK da tabela pai.",
                fail: "Devemos igualar a Chave Estrangeira (Produtos) com a Chave Primária (Categoria)."
            },
            {
                story: "23. [DCL] O 'vendedor' foi demitido. Precisamos remover todas as permissões dele antes de excluir o usuário.",
                question: "Qual comando retira permissões?",
                options: [
                    { sql: "DELETE GRANTS FROM 'vendedor';", correct: false },
                    { sql: "REVOKE ALL PRIVILEGES ON *.* FROM 'vendedor'@'localhost';", correct: true },
                    { sql: "REMOVE ACCESS 'vendedor';", correct: false }
                ],
                success: "Permissões revogadas (REVOKE).",
                fail: "Para tirar permissões, usamos REVOKE ... FROM ..."
            },
            {
                story: "24. [DCL] Auditoria final. Precisamos ver quais permissões o usuário 'gerente' possui atualmente.",
                question: "Como visualizamos isso?",
                options: [
                    { sql: "SELECT * FROM permissions WHERE user='gerente';", correct: false },
                    { sql: "SHOW GRANTS FOR 'gerente'@'localhost';", correct: true },
                    { sql: "VIEW ACCESS 'gerente';", correct: false }
                ],
                success: "Lista de permissões exibida.",
                fail: "O comando para ver permissões é SHOW GRANTS FOR."
            },
            {
                story: "25. [JOIN] Queremos listar todos os Fornecedores (tabela da direita), mesmo que eles não tenham entregue nenhum produto ainda.",
                question: "Qual JOIN prioriza a tabela da direita?",
                options: [
                    { sql: "LEFT JOIN", correct: false },
                    { sql: "RIGHT JOIN", correct: true },
                    { sql: "INNER JOIN", correct: false }
                ],
                success: "RIGHT JOIN traz tudo da tabela da direita.",
                fail: "Se a tabela prioritária está à direita do JOIN, use RIGHT JOIN."
            }
        ];

        // --- VARIÁVEIS DE ESTADO ---
        let currentPhase = 1; // 1 ou 2
        let currentLevelIndex = 0;
        let lives = 3;
        let seconds = 0;
        let timerInterval = null;
        let isGameOver = false;
        let isPhaseTransition = false;

        // Elementos do DOM
        const screen = document.getElementById('output-screen');
        const controls = document.getElementById('controls-area');
        const progressFill = document.getElementById('progress-fill');
        const levelIndicator = document.getElementById('level-indicator');
        const livesDisplay = document.getElementById('lives');
        const timerDisplay = document.getElementById('timer');
        const phaseDisplay = document.getElementById('phase-display');

        // --- FUNÇÕES DO SISTEMA ---

        function startTimer() {
            if (!timerInterval) {
                timerInterval = setInterval(() => {
                    seconds++;
                    const mins = Math.floor(seconds / 60).toString().padStart(2, '0');
                    const secs = (seconds % 60).toString().padStart(2, '0');
                    timerDisplay.innerText = `TEMPO: ${mins}:${secs}`;
                }, 1000);
            }
        }

        function stopTimer() {
            clearInterval(timerInterval);
            timerInterval = null;
        }

        function updateLivesDisplay() {
            let hearts = "";
            for(let i=0; i<lives; i++) hearts += "♥";
            for(let i=lives; i<3; i++) hearts += "♡";
            livesDisplay.innerText = `VIDAS: [${hearts}]`;
            
            if(lives === 2) livesDisplay.style.color = "#d29922";
            else if(lives === 1) livesDisplay.style.color = "#ff7b72";
            else livesDisplay.style.color = "#ff7b72";
        }

        function autoScroll() {
            screen.scrollTop = screen.scrollHeight;
        }

        function typeMessage(text, className = '') {
            const div = document.createElement('div');
            div.className = className;
            div.innerHTML = `> ${text}`;
            screen.appendChild(div);
            autoScroll();
        }

        function loadLevel() {
            if (isGameOver || isPhaseTransition) return;

            const currentLevels = currentPhase === 1 ? levelsPhase1 : levelsPhase2;

            if (currentLevelIndex >= currentLevels.length) {
                if (currentPhase === 1) {
                    triggerPhaseTransition();
                } else {
                    finishGame();
                }
                return;
            }

            const level = currentLevels[currentLevelIndex];
            
            // Atualiza barra
            const totalLevels = currentLevels.length;
            const progress = ((currentLevelIndex) / totalLevels) * 100;
            progressFill.style.width = `${progress}%`;
            
            // Indicador de Nível Global
            let displayLevel = currentPhase === 1 ? currentLevelIndex + 1 : currentLevelIndex + 16;
            let totalDisplay = 25;
            levelIndicator.innerText = `NÍVEL: ${displayLevel}/${totalDisplay}`;

            setTimeout(() => {
                screen.innerHTML += "<hr style='border-color: #30363d; margin: 20px 0;'>";
                typeMessage(level.story, 'msg-system');
                setTimeout(() => {
                    typeMessage(level.question, 'msg-npc');
                    autoScroll();
                    generateButtons(level);
                }, 500);
            }, 500);
        }

        function generateButtons(level) {
            controls.innerHTML = "";
            level.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.innerText = opt.sql;
                btn.onclick = () => checkAnswer(opt, level);
                controls.appendChild(btn);
            });
        }

        function checkAnswer(option, level) {
            const btns = controls.querySelectorAll('button');
            btns.forEach(b => b.disabled = true);

            typeMessage(`EXECUTANDO: ${option.sql}`, 'msg-sql');

            setTimeout(() => {
                if (option.correct) {
                    typeMessage(`[SUCESSO]: ${level.success}`, 'msg-success');
                    currentLevelIndex++;
                    setTimeout(loadLevel, 1500);
                } else {
                    handleError(level.fail);
                    if (!isGameOver) {
                        setTimeout(() => {
                            btns.forEach(b => b.disabled = false);
                        }, 1500);
                    }
                }
            }, 600);
        }

        function handleError(failMessage) {
            lives--;
            updateLivesDisplay();
            
            typeMessage("ALERTA DE SISTEMA: Inconsistência detectada! Correção imediata necessária.", 'msg-warning');
            typeMessage(`[ERRO TÉCNICO]: ${failMessage}`, 'msg-error');

            if (lives === 0) {
                gameOver();
            } else {
                if (lives === 2) {
                    typeMessage("AVISO: O Firewall registrou essa falha. Atenção!", 'msg-warning');
                } else if (lives === 1) {
                    typeMessage("CRÍTICO: Última tentativa! O servidor bloqueará seu IP.", 'msg-warning');
                }
            }
        }

        function triggerPhaseTransition() {
            isPhaseTransition = true;
            controls.innerHTML = "";
            screen.innerHTML += "<br><br>";
            typeMessage("========================================", 'msg-success');
            typeMessage(" FASE 1 CONCLUÍDA - DADOS BÁSICOS RECUPERADOS", 'msg-success');
            typeMessage("========================================", 'msg-success');
            typeMessage("Excelente trabalho, SysAdmin. Mas detectamos uma nova ameaça.", 'msg-npc');
            typeMessage("Hackers corromperam as tabelas de USUÁRIOS e as RELAÇÕES (Joins) entre tabelas.", 'msg-npc');
            typeMessage("Você tem coragem de iniciar a FASE 2 (Hard Mode)?", 'msg-npc');

            const btn = document.createElement('button');
            btn.innerText = "ACEITAR DESAFIO (INICIAR FASE 2)";
            btn.className = "btn-phase2";
            btn.onclick = () => startPhase2();
            controls.appendChild(btn);
        }

        function startPhase2() {
            isPhaseTransition = false;
            currentPhase = 2;
            currentLevelIndex = 0;
            lives = 3; // Reseta vidas para a nova fase
            updateLivesDisplay();
            
            phaseDisplay.innerText = "FASE: 2 (SEGURANÇA & JOINS)";
            phaseDisplay.style.color = "#d2a8ff"; // Roxo para fase 2
            
            typeMessage(">>> INICIANDO PROTOCOLO DE SEGURANÇA AVANÇADA...", 'msg-system');
            loadLevel();
        }

        function gameOver() {
            isGameOver = true;
            stopTimer();
            controls.innerHTML = "";
            screen.innerHTML = ""; 

            const img = document.createElement('img');
            img.src = "https://www.bitmag.com.br/wp-content/uploads/2022/03/Sete-adolescentes-sao-presos-por-conexao-com-hackers-do-Lapsus-acasacaiu-sebastiaan-stam-unsplash.png";
            img.className = "hacker-img";
            screen.appendChild(img);

            typeMessage("========================================", 'msg-error');
            typeMessage(" FALHA CRÍTICA - SISTEMA BLOQUEADO", 'msg-error');
            typeMessage("========================================", 'msg-error');
            
            if (currentPhase === 2) {
                typeMessage("Você falhou na Fase 2. O banco foi sequestrado.", 'msg-system');
                const btn = document.createElement('button');
                btn.innerText = "REINICIAR FASE 2";
                btn.style.backgroundColor = "#ff7b72";
                btn.style.borderColor = "#ff7b72";
                btn.onclick = () => {
                    isGameOver = false;
                    startTimer();
                    startPhase2(); // Reinicia da fase 2
                };
                controls.appendChild(btn);
            } else {
                typeMessage("Você falhou na recuperação básica.", 'msg-system');
                const btn = document.createElement('button');
                btn.innerText = "REINICIAR SISTEMA (DO ZERO)";
                btn.style.backgroundColor = "#ff7b72";
                btn.style.borderColor = "#ff7b72";
                btn.onclick = () => location.reload();
                controls.appendChild(btn);
            }
        }

        function finishGame() {
            stopTimer();
            progressFill.style.width = "100%";
            levelIndicator.innerText = "NÍVEL: 25/25";
            controls.innerHTML = "";
            screen.innerHTML += "<br><br>";
            typeMessage("========================================", 'msg-success');
            typeMessage(" VITÓRIA TOTAL - SISTEMA BLINDADO", 'msg-success');
            typeMessage("========================================", 'msg-success');
            typeMessage(`Tempo Total da Operação: ${timerDisplay.innerText.replace("TEMPO: ", "")}`, 'msg-npc');
            typeMessage("Parabéns! Você dominou DDL, DML, DQL, Normalização, DCL e JOINs.", 'msg-npc');
            typeMessage("Você é oficialmente um DBA Sênior.", 'msg-success');
            
            const btn = document.createElement('button');
            btn.innerText = "JOGAR NOVAMENTE";
            btn.style.textAlign = "center";
            btn.onclick = () => location.reload();
            controls.appendChild(btn);
        }

        // Inicia o jogo
        window.onload = () => {
            startTimer();
            loadLevel();
        };

    </script>
</body>
</html>